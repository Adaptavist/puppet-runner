---
prefixes:
- confluence_
- jira_
- application_
- connector_
- database_db_
required_facts:
- confluence_license
- confluence_host_name
classes:
- avstapp
- database
dependencies:
- avstapp
- stdlib
- oracle_java
- limits
- packages_repos
avstapp::conf:
  '%{::conf1_instance_name}':
    version: '%{::conf1_version}'
    application_type: confluence
    context_path: '%{::conf1_context_path}'
    shutport: '%{::conf1_app_shutport}'
    tarball_location_url: http://www.atlassian.com/software/confluence/downloads/binary/atlassian-confluence-%{::conf1_version}.tar.gz
    base_url: https://%{::conf1_host_name}
    avst_wizard_properties:
      license: '%{::conf1_license}'
      admin_user: '%{::conf1_admin_user}'
      admin_pass: '%{::conf1_admin_pass}'
      admin_full_name: '%{::conf1_admin_full_name}'
      admin_email: '%{::conf1_admin_email}'
      database_url: jdbc:mysql://localhost/%{::conf1_database_name}?sessionVariables=storage_engine%3DInnoDB
      database_user: '%{::conf1_database_user}'
      database_pass: '%{::conf1_database_pass}'
    drivers:
      location_path:
      - /etc/puppet/files/bins/mysql-connector-java-5.1.22-bin.jar
    java_flags:
      JVM_MINIMUM_MEMORY: '%{::conf1_JVM_MINIMUM_MEMORY}'
      JVM_MAXIMUM_MEMORY: '%{::conf1_JVM_MAXIMUM_MEMORY}'
      JVM_MAX_PERM_SIZE: '%{::conf1_JVM_MAX_PERM_SIZE}'
    connectors:
    - scheme: '%{::connector1_scheme}'
      http_port: '%{::connector1_app_port}'
      proxy_name: '%{::connector1_host_name}'
      proxy_port: '%{::connector1_port}'
    - scheme: '%{::connector2_scheme}'
      http_port: '%{::connector2_app_port}'
      proxy_name: '%{::connector2_host_name}'
      proxy_port: '%{::connector2_port}'
  '%{::conf2_instance_name}':
    version: '%{::conf2_version}'
    application_type: confluence
    context_path: '%{::conf2_context_path}'
    shutport: '%{::conf2_app_shutport}'
    tarball_location_url: http://www.atlassian.com/software/confluence/downloads/binary/atlassian-confluence-%{::conf2_version}.tar.gz
    base_url: https://%{::conf2_host_name}
    avst_wizard_properties:
      license: '%{::conf2_license}'
      admin_user: '%{::conf2_admin_user}'
      admin_pass: '%{::conf2_admin_pass}'
      admin_full_name: '%{::conf2_admin_full_name}'
      admin_email: '%{::conf2_admin_email}'
      database_url: jdbc:mysql://localhost/%{::conf2_database_name}?sessionVariables=storage_engine%3DInnoDB
      database_user: '%{::conf2_database_user}'
      database_pass: '%{::conf2_database_pass}'
    drivers:
      location_path:
      - /etc/puppet/files/bins/mysql-connector-java-5.1.22-bin.jar
    java_flags:
      JVM_MINIMUM_MEMORY: '%{::conf2_JVM_MINIMUM_MEMORY}'
      JVM_MAXIMUM_MEMORY: '%{::conf2_JVM_MAXIMUM_MEMORY}'
      JVM_MAX_PERM_SIZE: '%{::conf2_JVM_MAX_PERM_SIZE}'
    connectors:
    - scheme: '%{::connector3_scheme}'
      http_port: '%{::connector3_app_port}'
      proxy_name: '%{::connector3_host_name}'
      proxy_port: '%{::connector3_port}'
  '%{::jira_instance_name}':
    version: '%{::jira_version}'
    application_type: jira
    context_path: '%{::jira_context_path}'
    shutport: '%{::jira_app_shutport}'
    tarball_location_url: http://www.atlassian.com/software/jira/downloads/binary/atlassian-jira-%{::jira_version}.tar.gz
    base_url: https://%{::jira_host_name}
    avst_wizard_properties:
      admin_user: '%{::jira_admin_user}'
      admin_pass: '%{::jira_admin_pass}'
      admin_full_name: '%{::jira_admin_full_name}'
      admin_email: '%{::jira_admin_email}'
      mail_server_user: admin
      mail_server_pass: admin
      database_url: localhost
      database_user: '%{::jira_database_user}'
      database_pass: '%{::jira_database_pass}'
      database_name: '%{::jira_database_name}'
      instance_name: '%{::jira_app_instance_name}'
      license: '%{::jira_license}'
    drivers:
      location_path:
      - /etc/puppet/files/bins/mysql-connector-java-5.1.22-bin.jar
    java_flags:
      JVM_MINIMUM_MEMORY: '%{::jira_JVM_MINIMUM_MEMORY}'
      JVM_MAXIMUM_MEMORY: '%{::jira_JVM_MAXIMUM_MEMORY}'
      JVM_MAX_PERM_SIZE: '%{::jira_JVM_MAX_PERM_SIZE}'
    connectors:
    - scheme: '%{::connector4_scheme}'
      http_port: '%{::connector4_app_port}'
      proxy_name: '%{::connector4_host_name}'
      proxy_port: '%{::connector4_port}'
database_type: mysql
database::conf:
  '%{::jira1_database_name}':
    host: localhost
    collate: utf8_bin
    charset: utf8
    user: '%{::jira1_database_user}'
    password: '%{::jira1_database_pass}'
    name: '%{::jira1_database_name}'
  '%{::confluence1_database_name}':
    host: localhost
    collate: utf8_bin
    charset: utf8
    user: '%{::confluence1_database_user}'
    password: '%{::confluence1_database_pass}'
    name: '%{::confluence1_database_name}'
  '%{::confluence2_database_name}':
    host: localhost
    collate: utf8_bin
    charset: utf8
    user: '%{::confluence2_database_user}'
    password: '%{::confluence2_database_pass}'
    name: '%{::confluence2_database_name}'
